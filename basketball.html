<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Basketball Shooting Game</title>
    <script type="text/javascript" src="./X3DOM/x3dom.js"></script>
    <link rel="stylesheet" type="text/css" href="./X3DOM/x3dom.css" />
    <style>
        body {
            display: flex;
            justify-content: center;  /* Centers horizontally */
            align-items: flex-start;      /* Centers vertically */
            height: 100vh;            /* Full viewport height */
            margin: 0;                /* Remove default margins */
            background-color: #222;
            color: white;
            flex-direction: column;    /* Stack elements vertically */
        }

        .x3d-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;               /* Make sure it takes full width */
        }

        .controls { margin: 10px; }
        button, input { padding: 8px; font-size: 16px; }
        h1, h2 { margin: 5px; }

        .dropdown {
            position: relative;
            display: inline-block;
            z-index: 3;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #333;
            color: white;
            padding: 10px;
            list-style-type: none;
            border-radius: 5px;
            width: 250px;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .dropdown-content li {
            padding: 5px 0;
        }
    </style>
</head>

<body>
<h1>üèÄ 3D Basketball Shooting Game üèÄ</h1>
<h2 id="scoreboard">Score: 0 | Misses: 0</h2>

<!-- Controls -->
<div class="shooting-controls">
    Angle: <label for="angle"></label><input type="range" id="angle" min="20" max="70" value="45" oninput="updateTrajectory()">
    Power: <label for="power"></label><input type="range" id="power" min="5" max="20" value="10" oninput="updateTrajectory()">
    <button onclick="shootBall()">Shoot</button>
    <button onclick="toggleShootingPosition()">Switch Position</button>

    <div class="dropdown">
        <button>‚ÑπÔ∏è</button>
        <ul class="dropdown-content">
            <li>This game allows you to shoot a basketball in a 3D virtual environment.</li>

            <li><strong>Change Viewing Experience:</strong></li>
            <ul>
                <li>Press 1 : Front View</li>
                <li>Press 2 : Side View</li>
                <li>Press 3 : Birds Eye View</li>
                <li>Press 4 : Full Scene View</li>
                <li>Press "w" : to change the lighting in the scene between Day and Night.</li>
            </ul>

            <li><strong>How to Play:</strong></li>
            <ul>
                <li>Adjust the angle and power of your shot using the sliders. A green dotted line will appear to help you plan your trajectory.</li>
                <li>Use the "Switch Position" button OR "s" on your keyboard to switch between free-throw and 3-pointer shot positions on the court.</li>
                <li>Press the "Shoot" button or the "space" key on your keyboard to take your shot.</li>

            </ul>
        </ul>
    </div>
</div>


<div class="x3d-container">
<!-- X3DOM Scene -->
<x3d width=100% height="650px">
    <scene>
        <!-- Lighting -->
        <PointLight id="pointLight" location="0 10 5" intensity="1.5"></PointLight>
        <DirectionalLight id="directionalLight" direction="0 -1 -1" intensity="1.2" color="1 0.95 0.8"></DirectionalLight>
        <Background id="sceneBackground" skyColor="0.5 0.7 1"></Background> <!-- Daytime Sky -->
        <DirectionalLight id="ambientLight" direction="0 1 0" color="1 1 0.9"></DirectionalLight>

        <!-- Camera -->
        <Viewpoint id="mainCamera" position="0 5 12" orientation="0 1 0 0" description="Court View"></Viewpoint>

        <Transform translation="0 0 0" rotation="1 0 0 3.1416" scale="10 10 10">
            <!--- Hemisphere from http://x3dgraphics.com/examples/X3dForAdvancedModeling/GeometricShapes/HemisphereX3dom.xhtml --->
            <Shape DEF='Hemisphere'>
                <!-- Geodesic Hemisphere Order 4, radius 1m -->
                <IndexedFaceSet coordIndex='0 1 2 -1 1 3 4 -1 2 4 5 -1 3 6 7 -1 4 7 8 -1 5 8 9 -1 6 10 11 -1 7 11 12 -1 8 12 13 -1 9 13 14 -1 10 15 16 -1 11 16 17 -1 12 17 18 -1 13 18 19 -1 14 19 20 -1 1 4 2 -1 3 7 4 -1 4 8 5 -1 6 11 7 -1 7 12 8 -1 8 13 9 -1 10 16 11 -1 11 17 12 -1 12 18 13 -1 13 19 14 -1 21 22 23 -1 22 24 25 -1 23 25 26 -1 24 27 28 -1 25 28 29 -1 26 29 30 -1 27 31 32 -1 28 32 33 -1 29 33 34 -1 30 34 35 -1 31 0 2 -1 32 2 5 -1 33 5 9 -1 34 9 14 -1 35 14 20 -1 22 25 23 -1 24 28 25 -1 25 29 26 -1 27 32 28 -1 28 33 29 -1 29 34 30 -1 31 2 32 -1 32 5 33 -1 33 9 34 -1 34 14 35 -1 21 36 22 -1 36 37 38 -1 22 38 24 -1 37 39 40 -1 38 40 41 -1 24 41 27 -1 41 42 43 -1 27 43 31 -1 31 44 0 -1 36 38 22 -1 37 40 38 -1 38 41 24 -1 40 42 41 -1 41 43 27 -1 43 44 31 -1 15 45 16 -1 45 46 47 -1 16 47 17 -1 46 48 49 -1 47 49 50 -1 17 50 18 -1 48 51 52 -1 49 52 53 -1 50 53 54 -1 18 54 19 -1 51 55 56 -1 52 56 57 -1 53 57 58 -1 54 58 59 -1 19 59 20 -1 45 47 16 -1 46 49 47 -1 47 50 17 -1 48 52 49 -1 49 53 50 -1 50 54 18 -1 51 56 52 -1 52 57 53 -1 53 58 54 -1 54 59 19 -1 15 60 45 -1 45 61 46 -1 61 62 63 -1 46 63 48 -1 63 64 65 -1 48 65 51 -1 64 66 67 -1 65 67 68 -1 51 68 55 -1 60 61 45 -1 61 63 46 -1 62 64 63 -1 63 65 48 -1 64 67 65 -1 65 68 51 -1 55 69 56 -1 69 70 71 -1 56 71 57 -1 70 72 73 -1 71 73 74 -1 57 74 58 -1 72 75 76 -1 73 76 77 -1 74 77 78 -1 58 78 59 -1 75 79 80 -1 76 80 81 -1 77 81 82 -1 78 82 83 -1 59 83 20 -1 69 71 56 -1 70 73 71 -1 71 74 57 -1 72 76 73 -1 73 77 74 -1 74 78 58 -1 75 80 76 -1 76 81 77 -1 77 82 78 -1 78 83 59 -1 55 84 69 -1 84 85 86 -1 69 86 70 -1 85 87 88 -1 86 88 89 -1 70 89 72 -1 87 90 91 -1 88 91 92 -1 89 92 93 -1 72 93 75 -1 90 94 95 -1 91 95 96 -1 92 96 97 -1 93 97 98 -1 75 98 79 -1 84 86 69 -1 85 88 86 -1 86 89 70 -1 87 91 88 -1 88 92 89 -1 89 93 72 -1 90 95 91 -1 91 96 92 -1 92 97 93 -1 93 98 75 -1 79 99 80 -1 99 100 101 -1 80 101 81 -1 100 102 103 -1 101 103 104 -1 81 104 82 -1 102 105 106 -1 103 106 107 -1 104 107 108 -1 82 108 83 -1 105 21 23 -1 106 23 26 -1 107 26 30 -1 108 30 35 -1 83 35 20 -1 99 101 80 -1 100 103 101 -1 101 104 81 -1 102 106 103 -1 103 107 104 -1 104 108 82 -1 105 23 106 -1 106 26 107 -1 107 30 108 -1 108 35 83 -1 79 109 99 -1 109 110 111 -1 99 111 100 -1 110 112 113 -1 111 113 114 -1 100 114 102 -1 112 115 116 -1 113 116 117 -1 114 117 118 -1 102 118 105 -1 115 119 120 -1 116 120 121 -1 117 121 122 -1 118 122 123 -1 105 123 21 -1 109 111 99 -1 110 113 111 -1 111 114 100 -1 112 116 113 -1 113 117 114 -1 114 118 102 -1 115 120 116 -1 116 121 117 -1 117 122 118 -1 118 123 105 -1 119 115 124 -1 115 112 128 -1 124 128 125 -1 112 110 129 -1 128 129 130 -1 125 130 126 -1 110 109 131 -1 129 131 132 -1 130 132 133 -1 126 133 127 -1 109 79 98 -1 131 98 97 -1 132 97 96 -1 133 96 95 -1 127 95 94 -1 115 128 124 -1 112 129 128 -1 128 130 125 -1 110 131 129 -1 129 132 130 -1 130 133 126 -1 109 98 131 -1 131 97 132 -1 132 96 133 -1 133 95 127 -1 39 37 135 -1 37 36 137 -1 135 137 138 -1 136 138 139 -1 36 21 123 -1 137 123 122 -1 138 122 121 -1 139 121 120 -1 134 120 119 -1 37 137 135 -1 135 138 136 -1 36 123 137 -1 137 122 138 -1 138 121 139 -1 139 120 134 -1 94 90 140 -1 90 87 141 -1 87 85 142 -1 141 142 143 -1 85 84 144 -1 142 144 145 -1 84 55 68 -1 144 68 67 -1 145 67 66 -1 90 141 140 -1 87 142 141 -1 85 144 142 -1 142 145 143 -1 84 68 144 -1 144 67 145 -1' creaseAngle='0.785398' solid='false'>
                    <Coordinate point='0.5257 0 0.8507 0.3477 0 0.9376 0.4636 0.1875 0.866 0.1227 0 0.9924 0.2531 0.2047 0.9455 0.368 0.397 0.8408 -0.1227 0 0.9924 0 0.2116 0.9773 0.1308 0.4233 0.8965 0.2453 0.5955 0.765 -0.3477 0 0.9376 -0.2531 0.2047 0.9455 -0.1308 0.4233 0.8965 0 0.6142 0.7891 0.1159 0.7501 0.6511 -0.5257 0 0.8507 -0.4636 0.1875 0.866 -0.368 0.397 0.8408 -0.2453 0.5955 0.765 -0.1159 0.7501 0.6511 0 0.8507 0.5257 0.8507 0.5257 0 0.866 0.4636 0.1875 0.7501 0.6511 0.1159 0.8408 0.368 0.397 0.7408 0.5844 0.3313 0.5955 0.765 0.2453 0.765 0.2453 0.5955 0.6849 0.4732 0.5541 0.5541 0.6849 0.4732 0.397 0.8408 0.368 0.6511 0.1159 0.7501 0.5844 0.3313 0.7408 0.4732 0.5541 0.6849 0.3313 0.7408 0.5844 0.1875 0.866 0.4636 0.9376 0.3477 0 0.9924 0.1227 0 0.9455 0.2531 0.2047 0.9924 0 0 0.9773 0 0.2116 0.8965 0.1308 0.4233 0.8965 0 0.4233 0.7891 0 0.6142 0.6511 0 0.7501 -0.6511 0.1159 0.7501 -0.765 0.2453 0.5955 -0.5844 0.3313 0.7408 -0.8408 0.368 0.397 -0.6849 0.4732 0.5541 -0.4732 0.5541 0.6849 -0.866 0.4636 0.1875 -0.7408 0.5844 0.3313 -0.5541 0.6849 0.4732 -0.3313 0.7408 0.5844 -0.8507 0.5257 0 -0.7501 0.6511 0.1159 -0.5955 0.765 0.2453 -0.397 0.8408 0.368 -0.1875 0.866 0.4636 -0.6511 0 0.7501 -0.7891 0 0.6142 -0.8965 0 0.4233 -0.8965 0.1308 0.4233 -0.9773 0 0.2116 -0.9455 0.2531 0.2047 -0.9924 0 0 -0.9924 0.1227 0 -0.9376 0.3477 0 -0.7501 0.6511 -0.1159 -0.5955 0.765 -0.2453 -0.6142 0.7891 0 -0.397 0.8408 -0.368 -0.4233 0.8965 -0.1308 -0.4233 0.8965 0.1308 -0.1875 0.866 -0.4636 -0.2047 0.9455 -0.2531 -0.2116 0.9773 0 -0.2047 0.9455 0.2531 0 0.8507 -0.5257 0 0.9376 -0.3477 0 0.9924 -0.1227 0 0.9924 0.1227 0 0.9376 0.3477 -0.866 0.4636 -0.1875 -0.8408 0.368 -0.397 -0.7408 0.5844 -0.3313 -0.765 0.2453 -0.5955 -0.6849 0.4732 -0.5541 -0.5541 0.6849 -0.4732 -0.6511 0.1159 -0.7501 -0.5844 0.3313 -0.7408 -0.4732 0.5541 -0.6849 -0.3313 0.7408 -0.5844 -0.5257 0 -0.8507 -0.4636 0.1875 -0.866 -0.368 0.397 -0.8408 -0.2453 0.5955 -0.765 -0.1159 0.7501 -0.6511 0.1875 0.866 -0.4636 0.397 0.8408 -0.368 0.2047 0.9455 -0.2531 0.5955 0.765 -0.2453 0.4233 0.8965 -0.1308 0.2116 0.9773 0 0.7501 0.6511 -0.1159 0.6142 0.7891 0 0.4233 0.8965 0.1308 0.2047 0.9455 0.2531 0.1159 0.7501 -0.6511 0.2453 0.5955 -0.765 0.3313 0.7408 -0.5844 0.368 0.397 -0.8408 0.4732 0.5541 -0.6849 0.5541 0.6849 -0.4732 0.4636 0.1875 -0.866 0.5844 0.3313 -0.7408 0.6849 0.4732 -0.5541 0.7408 0.5844 -0.3313 0.5257 0 -0.8507 0.6511 0.1159 -0.7501 0.765 0.2453 -0.5955 0.8408 0.368 -0.397 0.866 0.4636 -0.1875 0.3477 0 -0.9376 0.1227 0 -0.9924 -0.1227 0 -0.9924 -0.3477 0 -0.9376 0.2531 0.2047 -0.9455 0.1308 0.4233 -0.8965 0 0.2116 -0.9773 0 0.6142 -0.7891 -0.1308 0.4233 -0.8965 -0.2531 0.2047 -0.9455 0.6511 0 -0.7501 0.9773 0 -0.2116 0.8965 0 -0.4233 0.9455 0.2531 -0.2047 0.8965 0.1308 -0.4233 0.7891 0 -0.6142 -0.6511 0 -0.7501 -0.7891 0 -0.6142 -0.8965 0.1308 -0.4233 -0.8965 0 -0.4233 -0.9455 0.2531 -0.2047 -0.9773 0 -0.2116'/>
                </IndexedFaceSet>
                <Appearance>
                    <ImageTexture url="https://raw.githubusercontent.com/loldwyer/X3DOM-Basketball-SIm/main/basketball-texture.webp"></ImageTexture>
                </Appearance>
            </Shape>
            </Transform>

        <Transform id="court" translation="0 0 0">
            <!-- Flat Surface on Top of Hemisphere -->
            <Transform translation="0 0 0">
                <Shape>
                    <Appearance>
                        <ImageTexture id="courtTexture1" url="https://raw.githubusercontent.com/loldwyer/X3DOM-Basketball-SIm/main/wood.jpg"></ImageTexture>
                        <Material id="courtMaterial1" diffuseColor="1 1 1"></Material>
                    </Appearance>
                    <Cylinder radius="10" height="0.05"></Cylinder>  <!-- Thin black disc -->
                </Shape>
            </Transform>

            <!-- Basketball Court -->
            <Transform translation="0 0 0">
                <Shape>
                    <Appearance>
                        <ImageTexture id="courtTexture2" url="https://raw.githubusercontent.com/loldwyer/X3DOM-Basketball-SIm/main/court.jpg"></ImageTexture>
                        <Material id="courtMaterial2" diffuseColor="1 1 1"></Material>
                    </Appearance>
                    <Box size="10 0.1 15"></Box>
                </Shape>
            </Transform>
        </Transform>


        <!-- Brick Wall Behind Backboard -->
        <Transform translation="0 3 -8">
            <Shape>
                <Appearance>
                    <ImageTexture url="https://raw.githubusercontent.com/loldwyer/X3DOM-Basketball-SIm/main/brick-wall.jpg"></ImageTexture>
                </Appearance>
                <Box size="10 6 0.2"></Box>
            </Shape>
        </Transform>

        <Transform id="backboardSystem">
            <!-- Backboard Pole -->
            <Transform translation="0 2 -7.5">
                <Shape>
                    <Appearance>
                        <Material diffuseColor="0.5 0.5 0.5" shininess="0.9" specularColor="1 1 1"></Material>
                    </Appearance>
                    <Cylinder radius="0.15" height="6"></Cylinder>
                </Shape>
            </Transform>

            <!-- Support Cylinder (Attaches pole to backboard) -->
            <Transform translation="0 4.9 -7.1" rotation="1 0 0 -1.57">
                <Shape>
                    <Appearance>
                        <Material diffuseColor="0.5 0.5 0.5" shininess="0.9" specularColor="1 1 1"></Material>
                    </Appearance>
                    <Cylinder radius="0.1" height="0.7"></Cylinder>
                </Shape>
            </Transform>

            <!-- Backboard -->
            <Transform translation="0 5 -6.8">
                <Shape>
                    <Appearance>
                        <ImageTexture url="https://raw.githubusercontent.com/loldwyer/X3DOM-Basketball-SIm/main/backboard.jpg"></ImageTexture>
                    </Appearance>
                    <Box size="2 1 0.05"></Box>
                </Shape>
            </Transform>

            <!-- Chain Link Net Attached to Hoop -->
            <Transform translation="0 4.4 -6.2"> <!-- Adjust to hoop position -->
                <!-- Orange Hoop -->
                <Transform rotation="1 0 0 1.57">
                    <Shape>
                        <Appearance>
                            <Material diffuseColor="1 0.5 0"></Material> <!-- Orange Rim -->
                        </Appearance>
                        <Torus innerRadius="0.08" outerRadius="0.6"></Torus> <!-- Hoop -->
                    </Shape>
                </Transform>
            </Transform>

            <!-- Chain Net (Triangular Segments) -->
            <Transform id="netContainer"></Transform>

        </Transform>

        <!-- Billboard Scoreboard (Always Faces Camera) -->
        <Billboard>
            <Transform id="scoreboard3D" translation="0 7 -8">
                <Shape>
                    <Appearance>
                        <Material id="scoreboardTextMaterial" diffuseColor="1 1 1"></Material>
                    </Appearance>
                    <Text id="scoreboardText" string='"Score: 0 | Misses: 0"' solid="false">
                        <FontStyle family='SANS' size='0.8' justify='["MIDDLE", "MIDDLE"]'></FontStyle>
                    </Text>
                </Shape>
            </Transform>
        </Billboard>

        <!-- Basketball -->
        <Transform id="ball" translation="0 1.5 2">
            <Shape>
                <Appearance>
                    <ImageTexture url="https://raw.githubusercontent.com/loldwyer/X3DOM-Basketball-SIm/main/basketball-texture.webp"></ImageTexture>
                </Appearance>
                <Sphere radius="0.2"></Sphere>
            </Shape>
        </Transform>

        <!-- Trajectory Preview (Series of Small Spheres) -->
        <Transform id="trajectory"> </Transform>

    </scene>
</x3d>
</div>

<script>
    let isThreePointPosition = true;
    let ballTransform = document.getElementById("ball");
    let trajectoryTransform = document.getElementById("trajectory");
    let angleSlider = document.getElementById("angle");
    let powerSlider = document.getElementById("power");
    let scoreboard = document.getElementById("scoreboard");
    let score = 0, misses = 0;
    let isMoving = false;
    let mainCamera = document.getElementById("mainCamera");


    function toggleShootingPosition() {
        if (isThreePointPosition) {
            ballTransform.setAttribute("translation", "0 1.5 -1"); // Move to free-throw line
            angleSlider.value=70; // Default score for free-throw line
            powerSlider.value=10;
        } else {
            ballTransform.setAttribute("translation", "0 1.5 2"); // Move back to 3-point line
            angleSlider.value = 70; // Default score for 3-point line
            powerSlider.value = 12;
        }
        isThreePointPosition = !isThreePointPosition;
        updateTrajectory();
    }

    window.onload = function() {
        setCameraView("0 3 12", "0 1 0 0");
        document.getElementById("angle").value = 70;
        document.getElementById("power").value = 12;
        createNet();
    };

    function createNet() {
        let netContainer = document.getElementById("netContainer");
        let numSegments = 12; // Number of vertical strands around the hoop
        let numLayers = 5; // Number of layers for net depth
        let radiusTop = 0.6; // Hoop outer radius
        let radiusBottom = 0.3; // Slightly narrower at bottom
        let heightStep = -0.15; // Distance between net layers
        let netHTML = "";

        for (let j = 0; j < numLayers; j++) {
            let layerRadius = radiusTop - (j / numLayers) * (radiusTop - radiusBottom);
            let yOffset = 4.4 + j * heightStep; // Lower each layer gradually

            for (let i = 0; i < numSegments; i++) {
                let angle1 = (i / numSegments) * 2 * Math.PI;
                let angle2 = ((i + 1) / numSegments) * 2 * Math.PI;

                let x1 = layerRadius * Math.cos(angle1);
                let z1 = layerRadius * Math.sin(angle1);
                let x2 = layerRadius * Math.cos(angle2);
                let z2 = layerRadius * Math.sin(angle2);
                let xMid = (x1 + x2) / 2;
                let zMid = (z1 + z2) / 2;

                netHTML += `
                    <Transform translation="0 ${yOffset} 0">
                        <Shape>
                            <Appearance>
                                <Material diffuseColor="1 1 1" transparency="0.3"></Material> <!-- White Transparent Net -->
                            </Appearance>
                            <IndexedFaceSet coordIndex="0 1 2 -1">
                                <Coordinate point="
                                    ${x1} 0 ${-6.2 + z1},
                                    ${x2} 0 ${-6.2 + z2},
                                    ${xMid} ${heightStep} ${-6.2 + zMid}
                                "></Coordinate>
                            </IndexedFaceSet>
                        </Shape>
                    </Transform>
                `;
            }
        }
        netContainer.innerHTML = netHTML;
    }

    // ** Camera Controls: Switch Views with Keyboard Keys (1,2,3) **
    document.addEventListener("keydown", function (event) {
        switch (event.key) {
            case "1":
                setCameraView("0 3 12", "0 1 0 0"); // Default Court View
                console.log("Camera: Default Court View");
                break;
            case "2":
                setCameraView("15 3 -2", "0 1 0 1.57"); // Side View
                console.log("Camera: Side View");
                break;
            case "3":
                setCameraView("0 30 0", "1 0 0 -1.57"); // Bird's Eye View
                console.log("Camera: Bird's Eye View");
                break;
            case "4":
                setCameraView("-8 4 20", "0.7 1 0 -0.5");
                console.log("Full View");
                break;
            case " ":
                event.preventDefault(); // allows for switching positions
                shootBall();
                break;
            case "s":
                toggleShootingPosition();
                break;
            case "w":
                toggleDayNight();
                break;
        }
    });


    function setCameraView(position, orientation) {
        mainCamera.setAttribute("position", position);
        mainCamera.setAttribute("orientation", orientation);
    }

    function updateTrajectory() {
        let power = parseFloat(powerSlider.value);
        let shotAngle = parseFloat(angleSlider.value);
        let positionZ = isThreePointPosition ? 2 : -1;

        let vY = power * Math.sin(shotAngle * Math.PI / 180);
        let vZ = -power * Math.cos(shotAngle * Math.PI / 180);
        let gravity = -9.8;

        console.log(`Trajectory updated: Angle=${shotAngle}, Power=${power}`);

        trajectoryTransform.innerHTML = ""; // Clear previous trajectory

        for (let t = 0; t < 1.5; t += 0.1) { // Predict trajectory for 1.5s
            let newX = 0;
            let newY = 1.5 + (vY * t) + (0.5 * gravity * t * t);
            let newZ = positionZ + vZ * t;

            trajectoryTransform.innerHTML += `
                    <Transform translation="${newX} ${newY} ${newZ}">
                        <Shape>
                            <Appearance>
                                <Material diffuseColor="0 1 0" transparency="0.5"></Material>
                            </Appearance>
                            <Sphere radius="0.08"></Sphere>
                        </Shape>
                    </Transform>
                `;
        }
    }

    function shootBall() {
        if (isMoving) return;
        isMoving = true;

        let shotAngle = parseFloat(angleSlider.value);
        let power = parseFloat(powerSlider.value);

        console.log(`Shooting ball with angle: ${shotAngle}, power: ${power}`);

        let vX = 0;
        let vY = power * Math.sin(shotAngle * Math.PI / 180);
        let vZ = -power * Math.cos(shotAngle * Math.PI / 180);
        let gravity = -9.8;

        let time = 0;
        let ballEnteredHoop = false;
        let rimTouched = false;

        let interval = setInterval(() => {
            time += 0.05;
            let newX = 0;
            let newY = 1.5 + (vY * time) + (0.5 * gravity * time * time);
            let newZ = isThreePointPosition ? 2 + vZ * time : -1 +vZ * time;

            console.log(`Ball Position -> X: ${newX}, Y: ${newY}, Z: ${newZ}`);

            // **Backboard Collision (Realistic Bounce)**
            if (newZ <= -6.8 && newY > 3.5) {
                if (Math.abs(newX) < 0.4) {
                    // Ball is near the hoop center, make it drop into the hoop
                    vX = 0;
                    vZ = -0.2;
                    vY *= 0.5;
                } else {
                    // Ball is off-center, make it bounce back
                    vZ *= -0.6;
                    vX += (Math.random() - 0.5) * 0.1;
                }
                bounceSound.play();
                resetBall();
            }

            // **Rim Collision - Ball Bounces Instead of Passing Through**
            // Detect Rim Collision - Ball Bounces Instead of Passing Through
            if (newY < 4.5 && newZ <= -6.5 && Math.abs(newX) < 0.45) {
                if (newY > 3.7) { // Ball is above rim
                    vY *= -0.5; // Reverse vertical speed for bounce
                    vX += (Math.random() - 0.5) * 0.1; // Random slight X deflection
                    vZ *= -0.5; // Reverse Z direction slightly
                    rimTouched = true;
                    bounceSound.play();
                    resetBall();
                }
            }


            // **Detect When Ball Enters Hoop (From Above)**
            if (newY > 3.6 && newY < 4.5 && newZ <= -6.2 && Math.abs(newX) < 0.4) {
                ballEnteredHoop = true;
            }
            // **Score**
            if (ballEnteredHoop && newY < 3.3 && newZ <= -6.2) {
                clearInterval(interval);
                updateScoreboard(true);
                resetBall();
                return;
            }

            // **Missed Shot - If Ball Hits the Ground**
            if (newY <= 0.3) {
                clearInterval(interval);
                updateScoreboard(false);
                resetBall();
                return;
            }

            ballTransform.setAttribute("translation", `${newX} ${newY} ${newZ}`);
        }, 30);

        trajectoryTransform.innerHTML = ""; // Remove trajectory after shooting
    }




    function resetBall() {
        setTimeout(() => {
            let positionZ = isThreePointPosition ? "2" : "-1";
            ballTransform.setAttribute("translation", `0 1.5 ${positionZ}`);
            isMoving = false;
        }, 1000);
    }

    // New Sound Effects - Crowd Reactions
    // Sound Effects (Updated with More Accurate Sounds)
    let cheerSound = new Audio("https://www.myinstants.com/media/sounds/crowd-cheer.mp3"); // Stadium crowd cheer
    let booSound = new Audio("https://www.myinstants.com/media/sounds/crowd-boo.mp3"); // Crowd booing
    let bounceSound = new Audio("https://www.myinstants.com/media/sounds/basketball-bounce.mp3"); // Real basketball rim bounce

    // Toggle Day/Night Mode
    let isDay = true;
    function toggleDayNight() {
        isDay = !isDay;

        // Get the existing lights
        let pointLight = document.getElementById("pointLight");
        let directionalLight = document.getElementById("directionalLight");
        let ambientLight = document.getElementById("ambientLight");
        let sceneBackground = document.getElementById("sceneBackground");
        let courtMaterial = document.querySelector("#courtMaterial"); // Get court material node

        if (isDay) {
            console.log("‚òÄÔ∏è Switching to **DAY MODE**");

            // Bright yellowish sunlight
            pointLight.setAttribute("intensity", "1.5");  // Brighter than before
            directionalLight.setAttribute("intensity", "1.2");
            directionalLight.setAttribute("color", "1 0.95 0.8"); // Warm sunlight

            // Ambient light to make everything brighter
            ambientLight.setAttribute("color", "1 1 0.9"); // Warm glow

            // Change background to simulate bright blue sky
            sceneBackground.setAttribute("skyColor", "0.5 0.7 1");

            courtMaterial.setAttribute("diffuseColor", "1 1 1");
            courtMaterial.setAttribute("transparency", "0");
        } else {
            console.log("üåô Switching to **NIGHT MODE**");

            // Darker and blueish moonlight
            pointLight.setAttribute("intensity", "0.3");  // Very dim
            directionalLight.setAttribute("intensity", "0.4");
            directionalLight.setAttribute("color", "0.3 0.3 0.7");  // Dark blue night light

            // Cool ambient light for night effect
            ambientLight.setAttribute("color", "0.2 0.2 0.5");

            // Change background to simulate dark night sky
            sceneBackground.setAttribute("skyColor", "0 0 0.2");

            courtMaterial.setAttribute("diffuseColor", "0.5 0.5 0.5"); // Darkened effect
            courtMaterial.setAttribute("transparency", "0.2"); // Slightly faded
        }
    }



    // Scoreboard Animation & Sound Effects
    function updateScoreboard(isScore) {
        let scoreboard = document.getElementById("scoreboard");
        let scoreboardText = document.getElementById("scoreboardText"); // 3D text element
        let scoreboardTextMaterial = document.getElementById("scoreboardTextMaterial"); // Text color
        let points = isThreePointPosition ? 3 : 2; // 3 for 3-point line, 2 for free-throw

        if (isScore) {
            score+=points;
            scoreboard.innerHTML = `üèÄ Crowd Cheers! +${points} Points!`;
            scoreboard.style.color = "#00FF00";
            cheerSound.play(); // Play crowd cheer sound
        } else {
            misses++;
            scoreboard.innerHTML = "‚ùå Crowd Boos! MISS";
            scoreboard.style.color = "#FF0000";
            booSound.play(); // Play booing sound
        }
        // Update the 3D scoreboard with the full score and misses
        scoreboardText.setAttribute("string", `"Score: ${score} | Misses: ${misses}"`);

        setTimeout(() => {
            scoreboard.innerHTML = `Score: ${score} | Misses: ${misses}`;
            scoreboard.style.color = "white";
        }, 2000);
    }

</script>


</body>
</html>
